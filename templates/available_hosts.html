{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col">
            <div class="table-responsive-sm">
                <fieldset>
                    <legend>Account</legend>
                    <div align="right">
                        <a href="/logout">Logout</a>
                    </div>
                    <p> Login: {{user.login}} </p>
                    <p> Telegram linked: {{user.tg_linked}} </p>
                    <dialog>
                        <p>Send code "{{user.link}}" to the bot</p>
                        <p>Telegram bot: <a href="https://t.me/{{bot_username}}" target="_blank">{{bot_username}}</a></p>
                        <br>
                        <button autofocus>Close</button>
                    </dialog>
                    <button>Link telegram</button>
                    <script>
                        const dialog = document.querySelector("dialog");
                        const showButton = document.querySelector("dialog + button");
                        const closeButton = document.querySelector("dialog button");

                        showButton.addEventListener("click", () => {
                            dialog.showModal();
                        });

                        closeButton.addEventListener("click", () => {
                            dialog.close();
                        });
                    </script>
                </fieldset>
                <br>
                <form hx-post="/hosts/lease" , hx-target="body">
                    <fieldset>
                        <legend>Available hosts</legend>
                        <fieldset>
                            <legend>Select lease period</legend>
                            <label for="days">Days:</label>
                            <input type="number" id="days" name="days" min="0" max="14" value="0">
                            <label for="days">Hours:</label>
                            <input type="number" id="hours" name="hours" min="0" max="24" value="1">
                        </fieldset>
                        {% for host in hosts %}
                        <input type="checkbox" id="{{host.id}}" name="hosts_ids" value="{{host.id}}">
                        <label for="{{host.id}}"> {{host.ip_address}} ({{host.hostname}}) </label><br>
                        {% endfor %}
                        <button type="submit">Lease selected</button>
                        <button hx-post="/hosts/lease/random">Lease random</button>
                    </fieldset>
                </form>
                <br>
                <form hx-post="/hosts/release" hx-target="body">
                    <fieldset>
                        <legend>Your leased hosts</legend>
                        {% for host in leased %}
                        <input type="checkbox" id="{{host.id}}" name="hosts_ids" value="{{host.id}}">
                        <label for="{{host.id}}"> {{host.ip_address}} ({{host.hostname}}) (until expiration: <time
                                datetime="{{host.leased_until}}"> {{host.valid_for}}</time>)
                        </label><br>
                        {% endfor %}
                        <button type="submit">Release selected</button>
                        <button hx-post="/hosts/release/all" hx-include="" hx-confirm="Are you sure?">Release
                            all</button>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}